<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Ранжирование</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      padding: 16px;
    }
    h3 {
      margin-bottom: 16px;
    }
    .list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: white;
      border: 1px solid #ddd;
      padding: 12px 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
      user-select: none;
    }
    .item.selected {
      cursor: grab;
    }
    .item.dragging {
      opacity: 0.6;
      background: #e3e9ff;
    }
    .badge {
      background: #5b6ef5;
      color: white;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      margin-right: 12px;
    }
    .item-content {
      display: flex;
      align-items: center;
      flex: 1;
    }
    .handle {
      font-size: 18px;
      cursor: grab;
      opacity: 0.4;
      padding-left: 8px;
    }
    button {
      margin-top: 16px;
      padding: 8px 16px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      background: #f44242;
      color: white;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h3>Отметь варианты в порядке важности</h3>
  <div id="list" class="list"></div>
  <button onclick="resetOrder()">Сбросить и начать заново</button>

  <script>
    const itemsData = ["Январь", "Февраль", "Март", "Апрель", "Май", "Июнь", "Июль", "Август", "Сентябрь", "Октябрь"];
    let selected = [];
    let dragIndex = null;
    let dragTimeout = null;

    function renderList() {
      const list = document.getElementById("list");
      list.innerHTML = "";

      // Сначала выбранные
      selected.forEach((text, i) => {
        const el = document.createElement("div");
        el.className = "item selected";
        el.setAttribute("draggable", "false");

        el.innerHTML = `
          <div class="item-content">
            <div class="badge">${i + 1}</div>
            ${text}
          </div>
          <div class="handle">☰</div>
        `;
        el.dataset.index = i;

        // DnD логика с задержкой
        const handle = el.querySelector('.handle');
        handle.addEventListener('touchstart', (e) => {
          e.stopPropagation();
          dragTimeout = setTimeout(() => {
            dragIndex = i;
            el.classList.add("dragging");
          }, 300); // задержка
        });
        handle.addEventListener('touchend', () => clearTimeout(dragTimeout));
        handle.addEventListener('touchmove', () => clearTimeout(dragTimeout));

        el.addEventListener("dragover", (e) => e.preventDefault());
        el.addEventListener("drop", (e) => {
          if (dragIndex !== null) {
            const toIndex = i;
            const moved = selected.splice(dragIndex, 1)[0];
            selected.splice(toIndex, 0, moved);
            dragIndex = null;
            renderList();
          }
        });

        list.appendChild(el);
      });

      // Потом оставшиеся
      itemsData.filter(x => !selected.includes(x)).forEach(text => {
        const el = document.createElement("div");
        el.className = "item";
        el.textContent = text;
        el.onclick = () => {
          selected.push(text);
          renderList();
        };
        list.appendChild(el);
      });
    }

    function resetOrder() {
      selected = [];
      renderList();
    }

    renderList();
  </script>
</body>
</html>
